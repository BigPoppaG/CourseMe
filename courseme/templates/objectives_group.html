{% extends "layout.html" %}
{% block content %}

<script type='text/javascript'>
//Add Class to table column given heading       DJG - repeat of code on index page - should move into main.js file
function addColumnClass(table_id, col_name, class_name) {
    col = $('#' + table_id + ' th:contains(' + col_name + ')');
    col_index = col.index() + 1; // Get the index & increment by 1 to match nth-child indexing
    $('#' + table_id + ' tr td:nth-child(' + col_index + ')').addClass(class_name);
}

$(document).ready(function () {

    $("#objectives_to_view").val({{scheme_id}})
    $("#students_to_view").val({{group.id}})
    
    //Button per objective to mark the corresponding objective as assessed
    $(".mark_assessed").on('click', function () {
        cell = this
        var objective_id = cell.id.split('_')[0]
        var profile_id = cell.id.split('_')[1]
        console.log("assess objective " + objective_id + " clicked")
        $.getJSON(
            flask_util.url_for('objective_assess', {profile_id: profile_id, objective_id: objective_id}), 
            function(result) {
                $(cell).removeClass("objective_not objective_partial warning objective_complete success");  //DJG - when objective classes are properly customised can remove the warning and succsess classes here   
                $(cell).addClass(result.assessed_display_class)
            }
        );
    });

    $("#objectives_to_view").on('change', function () {
        var scheme_id = $(this).val();
        console.log(scheme_id);
        window.location.href = flask_util.url_for('objectives_group', {group_id: {{group.id}}, scheme_id: scheme_id});
    });

    $("#students_to_view").on('change', function () {
        var group_id = $(this).val();
        window.location.href = flask_util.url_for('objectives_group', {group_id: group_id, scheme_id: {{scheme_id}}});
    });
 
    
})
</script>



<h1>{{group.name}} Progress</h1>

<form class="form-inline">
    <div class="form-group">
        <select id="objectives_to_view" class="form-control">
            <option value=0>All</option>
            {% for scheme in g.user.schemes_of_work.all() %}
            <option value={{scheme.id}}>{{scheme.name}}</option>
            {% endfor %}
        </select>
    </div>
    <div class="form-group">
        <select id="students_to_view" class="form-control">
            <option value=0>All</option>
            {% for gp in g.user.groups_created.all() %}
            <option value={{gp.id}}>{{gp.name}}</option>
            {% endfor %}
        </select>
    </div>
</form>


<table id="objective_progress" class="table table-condensed">
    <tr>
        <th></th>
        {% for profile in profiles %}
        <th class="DJG_rotate_headers"><a href="{{url_for('objectives', profile_id=profile.id, scheme_id=scheme_id)}}">{{profile.email}}</a></th>
        {% endfor %}
    </tr>
{% for objective in objectives %}    
    <tr>
        <td>{{objective.name}}</td>
        {% for profile in profiles %}
        <td id="{{ objective.id ~ '_' ~ profile.id ~ '_assess' }}" class="mark_assessed {{ objective.assessed_display_class(profile, g.user) }}"></td>
        {% endfor %}
        {% for profile in profiles %}        
        <td class="{{ objective.assessed_display_class(profile, profile) }}"></td>
        {% endfor %}    
    </tr>
{% endfor %}
    
</table>


{% endblock %}