{% extends "layout.html" %}
{% block content %}

<script type="text/javascript" src="/static/lib/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>

<style type="text/css" class="init">

    tr.group,
    tr.group:hover {
    background-color: #ddd !important;
    }

</style>

<form class="form-inline" role="form">
  <div class="form-group">
    <label class="sr-only" for="exampleInputEmail2">Email address</label>
    <input type="email" class="form-control" id="exampleInputEmail2" placeholder="Enter email">
  </div>
  <div class="form-group">
    <div class="input-group">
      <div class="input-group-addon">@</div>
      <input class="form-control" type="email" placeholder="Enter email">
    </div>
  </div>
  <div class="form-group">
    <label class="sr-only" for="exampleInputPassword2">Password</label>
    <input type="password" class="form-control" id="exampleInputPassword2" placeholder="Password">
  </div>

  <button type="submit" class="btn btn-default pull-right" id="select_questions">Print</button>
</form>

<h2>Questions</h2>


<!--{% for question in questions %}

<div class="row">
  <div class="col-md-1">
    <p>{{question.id}}</p>
  </div>
  <div class="col-md-9">
    <p>{{question.question}}</p>
  </div>
  <div class="col-md-1">
    <a href="{{url_for("edit_question", id=question.id)}}" class="{% if g.user.id != question.author_id %}hidden{% endif %}">edit</a>
  </div>
  <div class="col-md-1">
    <input class="include-question" name="include" type="checkbox" value={{question.id}}>
  </div>
</div>  

{% endfor %}-->

<table id="table_id" class="table" cellspacing="0" width="100%">
    <thead></thead>
    <tbody></tbody>
    <tfoot></tfoot>
</table>

<button id="clear_filters" type="Cancel" class="btn btn-default">Clear all filters</button>

<script>


//Add Class to column given heading
function addColumnClass(colName, className) {
    col = $('#table_id th:contains(' + colName + ')');
    col_index = col.index() + 1; // Get the index & increment by 1 to match nth-child indexing
    $('#table_id tr td:nth-child(' + col_index + ')').addClass(className);
}


$(document).ready( function () {                //DJG - https://datatables.net/manual/installation        
    
    //console.log({{catalogue | safe}});        
    var table = $('#table_id').DataTable( {
    
        //"paging":   false,
        //"ordering": false,
        //"info":     false,

        "aoColumnDefs": [  // enables turning off sorting for the columns
            {"bVisible": false, "aTargets": [0, 1]}  //DJG - targets grid columns to hide - just add the column to be disabled into the array
        ],

        data: {{catalogue | safe}},
        
        columns: [

            { data: 'id', name: 'id' },                
            { data: 'objectives', title: 'Objectives' },
            { data: 'question', title: 'Question' },
            { data: 'author', title: 'Author' },
            
            {
                "title":          'Include',
                "class":          'include-question',
                "orderable":      false,
                "data":           null,
                "defaultContent": ''
            }
        ],
        
        "order": [[ 1, 'asc' ]],
        
        "displayLength": 50,
        "drawCallback": function ( settings ) {
            var api = this.api();
            var rows = api.rows( {page:'current'} ).nodes();
            var last=[null];
 
            api.column(1, {page:'current'} ).data().each( function ( group, i ) {
                //DJG - need library to do deep comparison on the array objects in column 1 as the test always returns false otherwise
                if ( last[0] !== group[0] ) {
                    $(rows).eq( i ).before(
                        '<tr class="group"><td colspan="5">'+group+'</td></tr>'
                    );
                    //console.log(last);
                    //console.log(group);
                    //console.log(last==group);
                    last = group;
                }
            } );
        },
    
        "createdRow": function ( row, data, index ) {
            if ( data[4] > 4000 ) {
                $('td', row).eq(4).addClass('success');
            }
        }    
    
    } );

    
    //Add classes to columns for event handling
    //addColumnClass("Name", 'module-name-column')
    //addColumnClass("Author", 'module-author-column')

    //display hand cursor on hover to let User know it's a clickable link
    //$('.module-name-column, .module-author-column').hover(function() {
    //    $(this).css('cursor', 'pointer');
    //}, function() {
    //    $(this).css('cursor', 'auto');
    //});    
    //
    //$('.module-name-column').click(function() {
    //    module_id = table.row(this.parentNode).data().id;
    //    window.location.href = flask_util.url_for('module', {id: module_id });
    //});

    //display hand cursor on hover to let User know it's a clickable link
    $('.include-question').hover(function() {
        $(this).css('cursor', 'pointer');
    }, function() {
        $(this).css('cursor', 'auto');
    });    
    
    $('#table_id tbody').on('click', 'td.include-question', function () {       //DJG - don't know if I need this or can just do '.include-question'.click...
        var cell = this
        question_id = table.row(this.parentNode).data().id;
        console.log(question_id);
        $.getJSON(
                  flask_util.url_for('select_question', {id: question_id}),
                  function(json) {
                    console.log(json);
                    if (json.savedsuccess = "true") {
                      $(cell).removeClass("success");                      
                      $(cell).addClass(json.selected_class)
                      console.log(cell)
                    }
                  }
        ) 
    });    

} );


$("#clear_filters").on( 'click', function( event ) {
    window.location.reload()
});
    
</script>

{% endblock %}
